<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Minesweeper ‚Äî Secret Style</title>

  <style>
    :root{
      --bg:#0e0f11;
      --card:#15171c;
      --accent:#8ab4ff;
      --muted:#7a808a;
      --border:#1f2228;

      --cell:#1a1c22;
      --cell-hover:#22252c;
      --cell-open:#0f1114;

      --explode:#ff6b6b;
      --flag:#ffd479;
    }

    *{
      box-sizing:border-box;
      user-select:none;
      -webkit-tap-highlight-color: transparent;
    }

    body{
      margin:0;
      min-height:100vh;
      display:grid;
      place-items:center;
      font-family:Inter,Segoe UI,Roboto,Arial,sans-serif;
      background:var(--bg);
      color:#e4e7eb;
      padding:20px;
    }

    .card{
      width:100%;
      max-width:480px;
      background:var(--card);
      border-radius:16px;
      padding:28px;
      border:1px solid var(--border);
      box-shadow:0 8px 30px rgba(0,0,0,0.4);
    }

    h1{
      font-size:24px;
      margin:0 0 6px;
      letter-spacing:.5px;
      text-transform:uppercase;
      text-align:center;
    }

    p.lead{
      color:var(--muted);
      font-size:14px;
      text-align:center;
      margin:0 0 18px;
    }

    /* --- –í–µ—Ä—Ö–Ω—è—è –ø–∞–Ω–µ–ª—å —Å–ª–æ–∂–Ω–æ—Å—Ç–∏ --- */
    .top-bar{
      display:flex;
      justify-content:center;
      margin-bottom:16px;
    }

    .select{
      background:#1a1c22;
      color:#e4e7eb;
      border-radius:10px;
      border:1px solid var(--border);
      padding:10px 12px;
      font-size:14px;
    }

    /* --- –ò–≥—Ä–æ–≤–æ–µ –ø–æ–ª–µ --- */
    .board{
      display:grid;
      gap:6px;
      justify-content:center;
      margin-top:10px;
      transition:0.2s;
    }

    .cell{
      width:40px;
      height:40px;
      background:var(--cell);
      border-radius:10px;
      display:flex;
      align-items:center;
      justify-content:center;
      font-size:20px;
      cursor:pointer;
      border:1px solid var(--border);

      /* –∞–Ω–∏–º–∞—Ü–∏—è –∫–ª–∏–∫–∞ */
      transition:transform .12s cubic-bezier(.2,1.7,.6,1), background .2s, opacity .25s;
    }

    .cell:hover{
      background:var(--cell-hover);
    }

    /* —ç—Ñ—Ñ–µ–∫—Ç: –ø—Ä–∏ –Ω–∞–∂–∞—Ç–∏–∏ —É–º–µ–Ω—å—à–∞–µ—Ç—Å—è */
    .cell:active{
      transform:scale(.85);
    }

    /* –ø–ª–∞–≤–Ω–æ–µ –æ—Ç–∫—Ä—ã—Ç–∏–µ –∫–ª–µ—Ç–∫–∏ */
    .cell.open{
      background:var(--cell-open);
      cursor:default;
      border-color:#000;
      transform:scale(1)!important;
      opacity:1;
      animation:fadeInCell .18s ease;
    }

    @keyframes fadeInCell{
      0%{opacity:0; transform:scale(.7);}
      100%{opacity:1; transform:scale(1);}
    }

    /* —Ñ–ª–∞–≥ */
    .cell.flag{
      color:var(--flag);
    }

    /* –º–∏–Ω–∞ */
    .cell.mine{
      color:var(--explode);
    }

    /* –≤–∑—Ä—ã–≤–Ω–∞—è –∞–Ω–∏–º–∞—Ü–∏—è */
    .explode{
      animation:boom .3s ease-out;
    }

    @keyframes boom{
      0%{transform:scale(1); box-shadow:0 0 0 rgba(255,0,0,0);}
      40%{transform:scale(1.25); box-shadow:0 0 18px rgba(255,50,50,0.6);}
      100%{transform:scale(1); box-shadow:0 0 0 rgba(255,0,0,0);}
    }

    /* –Ω–∏–∑ */
    .bottom-bar{
      margin-top:18px;
      display:flex;
      justify-content:space-between;
      align-items:center;
    }

    .counter{
      color:var(--muted);
      font-size:14px;
    }

    .btn{
      background:var(--accent);
      color:#0a0d12;
      font-weight:600;
      padding:10px 16px;
      border-radius:12px;
      border:0;
      cursor:pointer;
      font-size:14px;
      transition:0.2s;
      text-transform:uppercase;
    }

    .btn:hover{
      background:#6da4ff;
    }

    /* –∞–¥–∞–ø—Ç–∞—Ü–∏—è —Ç–µ–ª–µ—Ñ–æ–Ω–∞ */
    @media (max-width:480px){
      .cell{width:34px;height:34px;font-size:18px;}
      .board{gap:4px;}
    }

    .msg{
      margin-top:12px;
      text-align:center;
      font-size:15px;
      color:var(--muted);
      min-height:22px;
    }
  </style>
</head>

<body>
<main class="card">
  <h1>Minesweeper</h1>
  <p class="lead">Dark UI ‚Äî Secret Fund Style</p>

  <div class="top-bar">
    <select id="difficulty" class="select">
      <option value="easy">–õ—ë–≥–∫–∞—è (8√ó8, 10 –º–∏–Ω)</option>
      <option value="medium">–°—Ä–µ–¥–Ω—è—è (12√ó12, 20 –º–∏–Ω)</option>
      <option value="hard">–°–ª–æ–∂–Ω–∞—è (16√ó16, 40 –º–∏–Ω)</option>
    </select>
  </div>

  <div id="board" class="board"></div>
  <div id="message" class="msg"></div>

  <div class="bottom-bar">
    <div class="counter">Flags: <span id="flagCount">0</span></div>
    <button class="btn" id="restart">Restart</button>
  </div>
</main>
<script>
/* ====== –ü–∞—Ä–∞–º–µ—Ç—Ä—ã —Å–ª–æ–∂–Ω–æ—Å—Ç–∏ ====== */
let SIZE = 8;
let MINES = 10;

/* ====== –ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –∏–≥—Ä—ã ====== */
let board = [];
let minePositions = [];
let flags = 0;
let revealed = 0;
let gameOver = false;

const boardEl = document.getElementById("board");
const msgEl = document.getElementById("message");
const flagCountEl = document.getElementById("flagCount");
const diffEl = document.getElementById("difficulty");

/* ====== –ê—É–¥–∏–æ ====== */
const soundClick = new Audio("data:audio/wav;base64,UklGRlQAAABXQVZFZm10IB4E...");  /* –∫–æ—Ä–æ—Ç–∫–∏–π –∫–ª–∏–∫ */
const soundFlag  = new Audio("data:audio/wav;base64,UklGRlQAAABXQVZFZm10IB4E...");  /* —Ñ–ª–∞–≥ */
const soundBoom  = new Audio("data:audio/wav;base64,UklGRlQAAABXQVZFZm10IB4E...");  /* –≤–∑—Ä—ã–≤ */
const soundWin   = new Audio("data:audio/wav;base64,UklGRlQAAABXQVZFZm10IB4E...");  /* –ø–æ–±–µ–¥–∞ */

/* (–ó–≤—É–∫–∏ –≤—Å—Ç–∞–≤–ª—é –Ω–æ—Ä–º–∞–ª—å–Ω—ã–µ –≤ —á–∞—Å—Ç–∏ 3) */


/* ====== –ó–∞–ø—É—Å–∫ –∏–≥—Ä—ã ====== */
init();

/* –°–º–µ–Ω–∞ —Å–ª–æ–∂–Ω–æ—Å—Ç–∏ */
diffEl.onchange = () => {
  const d = diffEl.value;
  if (d === "easy") { SIZE = 8; MINES = 10; }
  if (d === "medium") { SIZE = 12; MINES = 20; }
  if (d === "hard") { SIZE = 16; MINES = 40; }
  init();
};

/* Restart */
document.getElementById("restart").onclick = init;


/* ===========================
      –ò–ù–ò–¶–ò–ê–õ–ò–ó–ê–¶–ò–Ø –ò–ì–†–´
   =========================== */
function init(){
  board = [];
  minePositions = [];
  flags = 0;
  revealed = 0;
  gameOver = false;

  msgEl.textContent = "";
  flagCountEl.textContent = flags;

  boardEl.innerHTML = "";
  boardEl.style.gridTemplateColumns = `repeat(${SIZE}, 40px)`;

  generateBoard();
  placeMines();
  calculateNumbers();
  renderBoard();
}


/* –°–æ–∑–¥–∞–Ω–∏–µ —Å—Ç—Ä—É–∫—Ç—É—Ä—ã –ø–æ–ª—è */
function generateBoard(){
  for(let r=0; r<SIZE; r++){
    board[r] = [];
    for(let c=0; c<SIZE; c++){
      board[r][c] = {
        r,c,
        mine:false,
        number:0,
        open:false,
        flag:false,
      };
    }
  }
}


/* –†–∞—Å—Å—Ç–∞–≤–ª—è–µ–º –º–∏–Ω—ã */
function placeMines(){
  while(minePositions.length < MINES){
    const r = Math.floor(Math.random()*SIZE);
    const c = Math.floor(Math.random()*SIZE);

    const cell = board[r][c];
    if(!cell.mine){
      cell.mine = true;
      minePositions.push(cell);
    }
  }
}


/* –°—á—ë—Ç —á–∏—Å–µ–ª */
function calculateNumbers(){
  for(let r=0;r<SIZE;r++){
    for(let c=0;c<SIZE;c++){
      if(board[r][c].mine) continue;
      board[r][c].number = neighbors(r,c).filter(n=>n.mine).length;
    }
  }
}


/* –°–æ—Å–µ–¥–Ω–∏–µ –∫–ª–µ—Ç–∫–∏ */
function neighbors(r,c){
  let arr=[];
  for(let dr=-1;dr<=1;dr++){
    for(let dc=-1;dc<=1;dc++){
      if(dr===0 && dc===0) continue;
      const nr=r+dr, nc=c+dc;
      if(nr>=0 && nr<SIZE && nc>=0 && nc<SIZE){
        arr.push(board[nr][nc]);
      }
    }
  }
  return arr;
}


/* ===========================
             –†–ï–ù–î–ï–†
   =========================== */
function renderBoard(){
  for(let r=0;r<SIZE;r++){
    for(let c=0;c<SIZE;c++){
      const cell = board[r][c];

      const div = document.createElement("div");
      div.className = "cell";
      div.dataset.r = r;
      div.dataset.c = c;

      /* –ü–ö–ú –¥–ª—è —Ñ–ª–∞–≥–∞ */
      div.addEventListener("contextmenu", rightClick);

      /* –õ–ö–ú (–æ—Ç–∫—Ä—ã—Ç—å) */
      div.addEventListener("click", leftClick);

      /* –ú–æ–±–∞–π–ª: –¥–æ–ª–≥–∏–π —Ç–∞–ø = —Ñ–ª–∞–≥ */
      let pressTimer = null;
      div.addEventListener('touchstart', e=>{
        pressTimer = setTimeout(()=> rightClick(e), 350);
      });
      div.addEventListener('touchend', e=>{
        clearTimeout(pressTimer);
      });

      boardEl.appendChild(div);
    }
  }
}


/* ===========================
     --- –û–ë–†–ê–ë–û–¢–ö–ê –ö–õ–ò–ö–û–í ---
   =========================== */

function leftClick(e){
  if(gameOver) return;

  const r = +e.target.dataset.r;
  const c = +e.target.dataset.c;
  const cell = board[r][c];

  if(cell.flag || cell.open) return;

  soundClick.currentTime = 0;
  soundClick.play();

  openCell(cell);
}


function rightClick(e){
  e.preventDefault();
  if(gameOver) return;

  const r = +e.target.dataset.r;
  const c = +e.target.dataset.c;
  const cell = board[r][c];

  if(cell.open) return;

  cell.flag = !cell.flag;

  flags += cell.flag ? 1 : -1;
  flagCountEl.textContent = flags;

  const div = getDiv(cell);
  div.textContent = cell.flag ? "‚öë" : "";
  div.classList.toggle("flag", cell.flag);

  soundFlag.currentTime = 0;
  soundFlag.play();
}


/* ===========================
          –û–¢–ö–†–´–¢–ò–ï –ö–õ–ï–¢–ö–ò
   =========================== */

function openCell(cell){
  if(cell.open) return;

  cell.open = true;
  revealed++;

  const div = getDiv(cell);
  div.classList.add("open");

  if(cell.mine){
    div.textContent = "üí•";
    div.classList.add("mine","explode");

    soundBoom.currentTime = 0;
    soundBoom.play();

    gameLose();
    return;
  }

  if(cell.number > 0){
    div.textContent = cell.number;
  } else {
    div.textContent = "";
    neighbors(cell.r, cell.c).forEach(n=>{
      if(!n.open && !n.mine) openCell(n);
    });
  }

  checkWin();
}


/* –ü–æ–∏—Å–∫ DIV –∫–ª–µ—Ç–∫–∏ */
function getDiv(cell){
  return boardEl.children[cell.r*SIZE + cell.c];
}


/* ===========================
              –ü–†–û–ò–ì–†–´–®
   =========================== */
function gameLose(){
  gameOver = true;
  msgEl.textContent = "üíÄ Game Over";

  minePositions.forEach(m=>{
    const d = getDiv(m);
    if(!m.open){
      d.textContent = "üí•";
      d.classList.add("mine","open","explode");
    }
  });
}


/* ===========================
               –ü–û–ë–ï–î–ê
   =========================== */
function checkWin(){
  if(revealed === SIZE*SIZE - MINES){
    gameOver = true;
    msgEl.textContent = "üèÜ You Win!";

    soundWin.currentTime = 0;
    soundWin.play();
  }
}
</script>
<script>
// -------------------------
// –õ–Å–ì–ö–ò–ï –ó–í–£–ö–ò (BASE64)
// -------------------------
const sndClick = new Audio("data:audio/mp3;base64,//uQxAAAAAAAAAAAAAAAAAAAAAAAWGluZwAAAA8AAAACAAACcQCA...");
const sndFlag  = new Audio("data:audio/mp3;base64,//uQxAAAAAAAAAAAAAAAAAAAAAAAWGluZwAAAA8AAAACAAACcQCA...");
const sndBoom  = new Audio("data:audio/mp3;base64,//uQxAAAAAAAAAAAAAAAAAAAAAAAWGluZwAAAA8AAAACAAACcQCA...");
const sndWin   = new Audio("data:audio/mp3;base64,//uQxAAAAAAAAAAAAAAAAAAAAAAAWGluZwAAAA8AAAACAAACcQCA...");

// –ú–∞–ª–µ–Ω—å–∫–∏–π —Ö–∞–∫ —á—Ç–æ–±—ã –∑–≤—É–∫–∏ –≤—Å–µ–≥–¥–∞ –±—ã–ª–∏ –≥–æ—Ç–æ–≤—ã
[sndClick, sndFlag, sndBoom, sndWin].forEach(a => a.volume = 0.4);


// -------------------------
// –ù–ê–°–¢–†–û–ô–ö–ò –°–õ–û–ñ–ù–û–°–¢–ò
// -------------------------
const difficultyPresets = {
  easy:   { size: 8,  mines: 10 },
  medium: { size: 12, mines: 22 },
  hard:   { size: 16, mines: 40 }
};

let size = 8;
let minesCount = 10;

document.getElementById("difficulty").addEventListener("change", e => {
  const v = e.target.value;
  size = difficultyPresets[v].size;
  minesCount = difficultyPresets[v].mines;
  resetGame();
});


// -------------------------
// –ì–õ–û–ë–ê–õ–¨–ù–´–ï –ü–ï–†–ï–ú–ï–ù–ù–´–ï –ò–ì–†–´
// -------------------------
let board = [];
let minePositions = [];
let revealed = 0;
let flags = 0;
let gameOver = false;


// -------------------------
// –í–°–ü–û–ú–û–ì–ê–¢–ï–õ–¨–ù–´–ï –§–£–ù–ö–¶–ò–ò
// -------------------------

// –ö–æ–æ—Ä–¥–∏–Ω–∞—Ç—ã –≤—Å—ë –≤–Ω—É—Ç—Ä–∏ –ø–æ–ª—è?
function inBounds(x, y) {
  return x >= 0 && x < size && y >= 0 && y < size;
}

// –ü–æ–ª—É—á–∏—Ç—å ID –∫–ª–µ—Ç–∫–∏ —Ç–∏–ø–∞ "c-3-5"
function cellId(x, y) {
  return `c-${x}-${y}`;
}

// –ü–æ–ª—É—á–∏—Ç—å HTML-—ç–ª–µ–º–µ–Ω—Ç –∫–ª–µ—Ç–∫–∏
function getCell(x, y) {
  return document.getElementById(cellId(x, y));
}

// –ü–µ—Ä–µ–º–µ—à–∞—Ç—å –º–∞—Å—Å–∏–≤
function shuffle(arr) {
  for (let i = arr.length - 1; i > 0; i--) {
    const j = Math.floor(Math.random() * (i + 1));
    [arr[i], arr[j]] = [arr[j], arr[i]];
  }
  return arr;
}

</script>
  <script>
// -------------------------
// –°–û–ó–î–ê–ù–ò–ï –ò–ì–†–û–í–û–ì–û –ü–û–õ–Ø
// -------------------------
function generateBoard() {
  board = [];
  minePositions = [];
  revealed = 0;
  flags = 0;
  gameOver = false;

  const container = document.getElementById("board");
  container.innerHTML = "";
  container.style.gridTemplateColumns = `repeat(${size}, 1fr)`;

  // –ì–µ–Ω–µ—Ä–∏—Ä—É–µ–º –ø—É—Å—Ç—É—é –º–∞—Ç—Ä–∏—Ü—É
  for (let x = 0; x < size; x++) {
    board[x] = [];
    for (let y = 0; y < size; y++) {
      board[x][y] = {
        mine: false,
        revealed: false,
        flagged: false,
        number: 0
      };

      const cell = document.createElement("div");
      cell.className = "cell";
      cell.id = cellId(x, y);
      cell.dataset.x = x;
      cell.dataset.y = y;

      // –õ–ö–ú ‚Äî –æ—Ç–∫—Ä—ã—Ç—å
      cell.addEventListener("click", handleClick);

      // –ü–ö–ú ‚Äî —Ñ–ª–∞–≥
      cell.addEventListener("contextmenu", e => {
        e.preventDefault();
        toggleFlag(x, y);
      });

      // –ù–∞ —Ç–µ–ª–µ—Ñ–æ–Ω–µ: —É–¥–µ—Ä–∂–∞–Ω–∏–µ = —Ñ–ª–∞–≥
      let touchTimer;
      cell.addEventListener("touchstart", () => {
        touchTimer = setTimeout(() => toggleFlag(x, y), 400);
      });
      cell.addEventListener("touchend", () => clearTimeout(touchTimer));

      container.appendChild(cell);
    }
  }

  // –°—Ç–∞–≤–∏–º –º–∏–Ω—ã
  const spots = [];
  for (let x = 0; x < size; x++)
    for (let y = 0; y < size; y++)
      spots.push([x, y]);

  shuffle(spots);

  for (let i = 0; i < minesCount; i++) {
    const [x, y] = spots[i];
    board[x][y].mine = true;
    minePositions.push([x, y]);
  }

  // –°—á–∏—Ç–∞–µ–º —Ü–∏—Ñ—Ä—ã
  for (let x = 0; x < size; x++) {
    for (let y = 0; y < size; y++) {
      if (board[x][y].mine) continue;

      let cnt = 0;
      for (let dx = -1; dx <= 1; dx++) {
        for (let dy = -1; dy <= 1; dy++) {
          if (dx === 0 && dy === 0) continue;
          const nx = x + dx, ny = y + dy;
          if (inBounds(nx, ny) && board[nx][ny].mine) cnt++;
        }
      }
      board[x][y].number = cnt;
    }
  }
}


// -------------------------
// –û–¢–ö–†–´–¢–¨ –ö–õ–ï–¢–ö–£
// -------------------------
function handleClick(e) {
  if (gameOver) return;

  const x = +this.dataset.x;
  const y = +this.dataset.y;
  const cell = board[x][y];

  if (cell.revealed || cell.flagged) return;

  revealCell(x, y);

  // –ê–Ω–∏–º–∞—Ü–∏—è –∫–ª–∏–∫–∞
  this.style.transform = "scale(0.92)";
  setTimeout(() => (this.style.transform = "scale(1)"), 120);

  // –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø–æ–±–µ–¥—ã
  if (revealed === size * size - minesCount) {
    winGame();
  }
}


// -------------------------
// –û–¢–ö–†–´–¢–ò–ï
// -------------------------
function revealCell(x, y) {
  const cell = board[x][y];
  if (cell.revealed || cell.flagged) return;

  const el = getCell(x, y);
  cell.revealed = true;
  revealed++;

  el.classList.add("open");
  sndClick.currentTime = 0;
  sndClick.play();

  // –ï—Å–ª–∏ –º–∏–Ω–∞ ‚Äî –ø—Ä–æ–∏–≥—Ä—ã—à
  if (cell.mine) {
    boom(x, y);
    return;
  }

  // –ï—Å–ª–∏ 0 ‚Äî —Ä–∞—Å–∫—Ä—ã–≤–∞–µ–º –≤–æ–∫—Ä—É–≥
  if (cell.number === 0) {
    el.textContent = "";
    revealAround(x, y);
  } else {
    el.textContent = cell.number;
    el.style.color = numberColor(cell.number);
  }
}


// -------------------------
// –ê–í–¢–û-–†–ê–°–ö–†–´–¢–ò–ï
// -------------------------
function revealAround(x, y) {
  for (let dx = -1; dx <= 1; dx++) {
    for (let dy = -1; dy <= 1; dy++) {
      if (dx === 0 && dy === 0) continue;
      const nx = x + dx, ny = y + dy;
      if (inBounds(nx, ny)) revealCell(nx, ny);
    }
  }
}


// -------------------------
// –§–õ–ê–ì
// -------------------------
function toggleFlag(x, y) {
  if (gameOver) return;
  const cell = board[x][y];
  const el = getCell(x, y);

  if (cell.revealed) return;

  cell.flagged = !cell.flagged;
  el.classList.toggle("flag");

  sndFlag.currentTime = 0;
  sndFlag.play();
}


// -------------------------
// –í–ó–†–´–í
// -------------------------
function boom(x, y) {
  gameOver = true;

  sndBoom.currentTime = 0;
  sndBoom.play();

  const el = getCell(x, y);
  el.style.background = "#ff4f4f";

  // –¢—Ä—è—Å–∫–∞
  document.body.classList.add("shake");
  setTimeout(() => document.body.classList.remove("shake"), 500);

  // –ü–æ–∫–∞–∑–∞—Ç—å –≤—Å–µ –º–∏–Ω—ã
  minePositions.forEach(([mx, my]) => {
    const c = getCell(mx, my);
    c.classList.add("open");
    c.style.background = board[mx][my].mine ? "#b12222" : "";
    c.textContent = "üí£";
  });
}


// -------------------------
// –ü–û–ë–ï–î–ê
// -------------------------
function winGame() {
  gameOver = true;

  sndWin.currentTime = 0;
  sndWin.play();

  setTimeout(() => {
    alert("üéâ –ü–æ–±–µ–¥–∞! –¢—ã —Ä–∞–∑–º–∏–Ω–∏—Ä–æ–≤–∞–ª –ø–æ–ª–µ.");
  }, 150);
}


// -------------------------
// –¶–í–ï–¢ –¶–ò–§–†–´
// -------------------------
function numberColor(n) {
  return ["#9ec2ff", "#90f2c5", "#ffec80", "#ffb28a",
          "#ff8a8a", "#e6a0ff", "#b2b2b2", "#ffffff"][n-1];
}


// -------------------------
// –°–ë–†–û–° –ò–ì–†–´
// -------------------------
function resetGame() {
  generateBoard();
}

document.getElementById("restart").onclick = resetGame;

// –°—Ç–∞—Ä—Ç
generateBoard();

</script>
