<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Minesweeper ‚Äî Secret Style</title>
<style>
:root{
  --bg:#0e0f11;
  --card:#15171c;
  --accent:#8ab4ff;
  --muted:#7a808a;
  --border:#1f2228;
  --cell:#1a1c22;
  --cell-hover:#22252c;
  --cell-open:#0f1114;
  --explode:#ff6b6b;
  --flag:#ffd479;
}

*{box-sizing:border-box;user-select:none;-webkit-tap-highlight-color: transparent;}

body{
  margin:0;
  min-height:100vh;
  display:grid;
  place-items:center;
  font-family:Inter,Segoe UI,Roboto,Arial,sans-serif;
  background:var(--bg);
  color:#e4e7eb;
  padding:20px;
}

.card{
  width:100%;
  max-width:480px;
  background:var(--card);
  border-radius:16px;
  padding:28px;
  border:1px solid var(--border);
  box-shadow:0 8px 30px rgba(0,0,0,0.4);
  display:flex;
  flex-direction:column;
  align-items:center;
}

h1{
  font-size:24px;
  margin:0 0 6px;
  letter-spacing:.5px;
  text-transform:uppercase;
  text-align:center;
}
p.lead{
  color:var(--muted);
  font-size:14px;
  text-align:center;
  margin:0 0 18px;
}

.top-bar{
  display:flex;
  justify-content:center;
  margin-bottom:16px;
}

.select{
  background:#1a1c22;
  color:#e4e7eb;
  border-radius:10px;
  border:1px solid var(--border);
  padding:10px 12px;
  font-size:14px;
}

#board {
  display: grid;
  gap:4px;
  width:100%;
  margin-top:20px;

  /* –∞–¥–∞–ø—Ç–∏–≤–Ω–∞—è –≤—ã—Å–æ—Ç–∞: –≤—ã—Å–æ—Ç–∞ = —à–∏—Ä–∏–Ω–∞ * size/size = –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ */
  /* —É–±–∏—Ä–∞–µ–º —Ñ–∏–∫—Å–∏—Ä–æ–≤–∞–Ω–Ω—ã–π aspect-ratio */
}

.cell {
  background:var(--cell);
  border:1px solid var(--border);
  border-radius:6px;
  display:flex;
  align-items:center;
  justify-content:center;
  font-size:calc(24px * (480px / (SIZE*32))); /* –∞–¥–∞–ø—Ç–∏–≤–Ω—ã–π —à—Ä–∏—Ñ—Ç */
  font-weight:600;
  cursor:pointer;
  transition: transform .12s, background .2s, opacity .25s;
  position: relative;

  /* –∫–ª—é—á–µ–≤–æ–µ: —à–∏—Ä–∏–Ω–∞ –∏ –≤—ã—Å–æ—Ç–∞ = 100% / –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –∫–ª–µ—Ç–æ–∫ */
  width: calc(100% / var(--size));
  padding-top: calc(100% / var(--size)); /* –¥–ª—è –∫–≤–∞–¥—Ä–∞—Ç–∞ */
}

.cell:hover{background:var(--cell-hover);}
.cell:active{transform:scale(.85);}
.cell.open[data-number]:not(.flag) {
  font-size: calc(0.6 * (100% / var(--size)));
}
.cell.flag::after{content:"üö©"; position:absolute; font-size:18px;}
.cell.mine{color:var(--explode);}
.explode{animation:boom .3s ease-out;}

.cell.flag::after {
  content:"üö©";
  position:absolute;
  font-size: calc(0.6 * (100% / var(--size))); /* –º–∞—Å—à—Ç–∞–±–∏—Ä—É–µ–º –ø–æ —Ä–∞–∑–º–µ—Ä—É –∫–ª–µ—Ç–∫–∏ */
}

@keyframes fadeInCell{
  0%{opacity:0; transform:scale(.7);}
  100%{opacity:1; transform:scale(1);}
}
@keyframes boom{
  0%{transform:scale(1); box-shadow:0 0 0 rgba(255,0,0,0);}
  40%{transform:scale(1.25); box-shadow:0 0 18px rgba(255,50,50,0.6);}
  100%{transform:scale(1); box-shadow:0 0 0 rgba(255,0,0,0);}
}

/* –¶–≤–µ—Ç —Ü–∏—Ñ—Ä */
.cell.open[data-number="1"]:not(.flag){color:#0096ff;}
.cell.open[data-number="2"]:not(.flag){color:#33ff99;}
.cell.open[data-number="3"]:not(.flag){color:#ffcb33;}
.cell.open[data-number="4"]:not(.flag){color:#ff5c33;}
.cell.open[data-number="5"]:not(.flag){color:#ff33aa;}
.cell.open[data-number="6"]:not(.flag){color:#8c33ff;}
.cell.open[data-number="7"]:not(.flag){color:#33fff3;}
.cell.open[data-number="8"]:not(.flag){color:#ffffff;}

.bottom-bar{
  margin-top:18px;
  display:flex;
  justify-content:space-between;
  width:100%;
  align-items:center;
}
.counter{color:var(--muted); font-size:14px;}
.btn{
  background:var(--accent);
  color:#0a0d12;
  font-weight:600;
  padding:10px 16px;
  border-radius:12px;
  border:0;
  cursor:pointer;
  font-size:14px;
  transition:0.2s;
  text-transform:uppercase;
}
.btn:hover{background:#6da4ff;}

.msg{
  margin-top:12px;
  text-align:center;
  font-size:15px;
  color:var(--muted);
  min-height:22px;
}

/* –ê–¥–∞–ø—Ç–∞—Ü–∏—è –ø–æ–¥ —Ç–µ–ª–µ—Ñ–æ–Ω */
@media (max-width:480px){
  .cell{font-size:16px;}
  #board{gap:3px;}
}
</style>
</head>
<body>
<main class="card">
<h1>Minesweeper</h1>
<p class="lead">Dark UI ‚Äî Secret Fund Style</p>
<div class="top-bar">
  <select id="difficulty" class="select">
    <option value="easy">–õ—ë–≥–∫–∞—è (8√ó8, 10 –º–∏–Ω)</option>
    <option value="medium">–°—Ä–µ–¥–Ω—è—è (12√ó12, 22 –º–∏–Ω)</option>
    <option value="hard">–°–ª–æ–∂–Ω–∞—è (16√ó16, 40 –º–∏–Ω)</option>
  </select>
</div>
<div id="board"></div>
<div id="message" class="msg"></div>
<div class="msg" id="highScore"></div>
<div class="bottom-bar">
  <div class="counter">Flags: <span id="flagCount">0</span></div>
  <button class="btn" id="restart">Restart</button>
</div>
</main>

<script>
// –ú–∏–Ω–∏-–∑–≤—É–∫–∏ (–≤—Å—Ç—Ä–æ–µ–Ω–Ω—ã–µ)
const sndClick = new Audio("data:audio/mp3;base64,//uQxAAAAAAAAAAAAAAAAAAAAAAAWGluZwAAAA8AAAACAAACcQCA...");
const sndFlag  = new Audio("data:audio/mp3;base64,//uQxAAAAAAAAAAAAAAAAAAAAAAAWGluZwAAAA8AAAACAAACcQCA...");
const sndBoom  = new Audio("data:audio/mp3;base64,//uQxAAAAAAAAAAAAAAAAAAAAAAAWGluZwAAAA8AAAACAAACcQCA...");
const sndWin   = new Audio("data:audio/mp3;base64,//uQxAAAAAAAAAAAAAAAAAAAAAAAWGluZwAAAA8AAAACAAACcQCA...");
[sndClick, sndFlag, sndBoom, sndWin].forEach(a=>a.volume=0.4);

// –ù–∞—Å—Ç—Ä–æ–π–∫–∏
let SIZE=8, MINES=10;
let board=[], minePositions=[], revealed=0, flags=0, gameOver=false;

const boardEl=document.getElementById("board");
const msgEl=document.getElementById("message");
const flagCountEl=document.getElementById("flagCount");
const highScoreEl=document.getElementById("highScore");
const diffEl=document.getElementById("difficulty");

const difficultyPresets={easy:{size:8,mines:10},medium:{size:12,mines:22},hard:{size:16,mines:40}};

// –°–º–µ–Ω–∞ —Å–ª–æ–∂–Ω–æ—Å—Ç–∏
diffEl.onchange=()=>{
  const v=diffEl.value;
  SIZE=difficultyPresets[v].size; MINES=difficultyPresets[v].mines;
  resetGame();
  updateHighScore();
};

// –°–æ–∑–¥–∞–Ω–∏–µ –ø–æ–ª—è
function resetGame(){
  boardEl.style.setProperty('--size', SIZE);
  board=[]; minePositions=[]; revealed=0; flags=0; gameOver=false;
  flagCountEl.textContent=flags; msgEl.textContent="";
  boardEl.innerHTML="";
  boardEl.style.gridTemplateColumns=`repeat(${SIZE},1fr)`;

  for(let x=0;x<SIZE;x++){
    board[x]=[];
    for(let y=0;y<SIZE;y++){
      board[x][y]={mine:false,revealed:false,flagged:false,number:0};
      const cell=document.createElement("div");
      cell.className="cell";
      cell.dataset.x=x; cell.dataset.y=y;

      cell.addEventListener("click",()=>handleClick(x,y));
      cell.addEventListener("contextmenu",e=>{e.preventDefault(); toggleFlag(x,y);});

      let touchTimer;
      cell.addEventListener('touchstart',()=>{touchTimer=setTimeout(()=>toggleFlag(x,y),400);});
      cell.addEventListener('touchend',()=>clearTimeout(touchTimer));

      boardEl.appendChild(cell);
    }
  }

  // –†–∞—Å—Å—Ç–∞–≤–ª—è–µ–º –º–∏–Ω—ã
  const spots=[]; for(let x=0;x<SIZE;x++)for(let y=0;y<SIZE;y++)spots.push([x,y]);
  for(let i=0;i<MINES;i++){
    const [x,y]=spots.splice(Math.floor(Math.random()*spots.length),1)[0];
    board[x][y].mine=true; minePositions.push([x,y]);
  }

  // –°—á–∏—Ç–∞–µ–º —Ü–∏—Ñ—Ä—ã
  for(let x=0;x<SIZE;x++){
    for(let y=0;y<SIZE;y++){
      if(board[x][y].mine) continue;
      let cnt=0;
      for(let dx=-1;dx<=1;dx++)for(let dy=-1;dy<=1;dy++){
        if(dx===0&&dy===0) continue;
        const nx=x+dx, ny=y+dy;
        if(nx>=0&&nx<SIZE&&ny>=0&&ny<SIZE&&board[nx][ny].mine) cnt++;
      }
      board[x][y].number=cnt;
    }
  }

  updateHighScore();
}

// –ü–æ–ª—É—á–∏—Ç—å –∫–ª–µ—Ç–∫—É
function getCell(x,y){return boardEl.children[x*SIZE+y];}

// –ö–ª–∏–∫
function handleClick(x,y){
  if(gameOver) return;
  const cell=board[x][y];
  if(cell.revealed||cell.flagged) return;
  revealCell(x,y);
  const el=getCell(x,y);
  el.style.transform="scale(0.92)";
  setTimeout(()=>el.style.transform="scale(1)",120);
  if(revealed===SIZE*SIZE-MINES) winGame();
}

// –†–∞—Å–∫—Ä—ã—Ç–∏–µ
function revealCell(x,y){
  const cell=board[x][y];
  if(cell.revealed||cell.flagged) return;
  cell.revealed=true; revealed++;
  const el=getCell(x,y);
  el.classList.add("open");
  el.dataset.number = cell.number || "";
  sndClick.currentTime=0; sndClick.play();

  if(cell.mine){boom(x,y); return;}
  if(cell.number>0){el.textContent=cell.number;}else{el.textContent=""; revealAround(x,y);}
}

// –†–∞—Å–∫—Ä—ã—Ç–∏–µ –≤–æ–∫—Ä—É–≥
function revealAround(x,y){
  for(let dx=-1;dx<=1;dx++)for(let dy=-1;dy<=1;dy++){
    if(dx===0&&dy===0) continue;
    const nx=x+dx, ny=y+dy;
    if(nx>=0&&nx<SIZE&&ny>=0&&ny<SIZE) revealCell(nx,ny);
  }
}

// –§–ª–∞–≥
function toggleFlag(x,y){
  if(gameOver) return;
  const cell=board[x][y]; const el=getCell(x,y);
  if(cell.revealed) return;
  cell.flagged=!cell.flagged; el.classList.toggle("flag");
  sndFlag.currentTime=0; sndFlag.play();
  flags+=cell.flagged?1:-1; flagCountEl.textContent=flags;
}

// –í–∑—Ä—ã–≤
function boom(x,y){
  gameOver=true;
  sndBoom.currentTime=0; sndBoom.play();
  const el=getCell(x,y); el.style.background="#ff4f4f";
  minePositions.forEach(([mx,my])=>{
    const c=getCell(mx,my); c.classList.add("open"); if(board[mx][my].mine)c.textContent="üí£";
  });
}

// –ü–æ–±–µ–¥–∞
function winGame(){
  gameOver=true;
  sndWin.currentTime=0; sndWin.play();
  const key="minesweeper_wins_"+diffEl.value;
  let wins=parseInt(localStorage.getItem(key))||0; wins++; localStorage.setItem(key,wins);
  updateHighScore();
  setTimeout(()=>alert(`üéâ –ü–æ–±–µ–¥–∞! –í—Å–µ–≥–æ –ø–æ–±–µ–¥ –Ω–∞ ${diffEl.value}: ${wins}`),150);
}

// High Score
function updateHighScore(){
  const key="minesweeper_wins_"+diffEl.value;
  const wins=parseInt(localStorage.getItem(key))||0;
  highScoreEl.textContent=`üèÜ –ü–æ–±–µ–¥—ã –Ω–∞ ${diffEl.value}: ${wins}`;
}

// –°—Ç–∞—Ä—Ç –∏ —Ä–µ—Å—Ç–∞—Ä—Ç
document.getElementById("restart").onclick=resetGame;
resetGame();
</script>
</body>
</html>
