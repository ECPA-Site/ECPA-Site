<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <title>Roblox Mobile - Fixed Character Select</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <style>
        body { margin: 0; overflow: hidden; background: #87CEEB; font-family: sans-serif; touch-action: none; }
        
        /* –≠–∫—Ä–∞–Ω –≤—ã–±–æ—Ä–∞ */
        #char-select { position: fixed; inset: 0; background: #2c3e50; display: flex; flex-direction: column; align-items: center; justify-content: center; z-index: 1000; color: white; }
        .char-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 15px; }
        .char-card { padding: 20px; border-radius: 15px; text-align: center; cursor: pointer; width: 120px; font-weight: bold; border: 3px solid rgba(255,255,255,0.3); }
        .red { background: #ff4d4d; } .brown { background: #795548; }
        .blue { background: #2196f3; } .yellow { background: #ffeb3b; color: #000; }

        /* –ò–Ω—Ç–µ—Ä—Ñ–µ–π—Å –∏–≥—Ä—ã */
        #gui { position: fixed; top: 10px; left: 10px; color: white; display: none; pointer-events: none; z-index: 10; }
        .card { background: rgba(0,0,0,0.5); padding: 10px; border-radius: 10px; }
        .bar { width: 150px; height: 10px; background: #222; border-radius: 5px; margin-top: 5px; overflow: hidden; }
        #hp-fill { width: 100%; height: 100%; background: #00ff44; }

        /* –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ */
        #controls { display: none; }
        #joystick-zone { position: fixed; bottom: 40px; left: 40px; width: 100px; height: 100px; background: rgba(255,255,255,0.2); border-radius: 50%; border: 2px solid white; }
        #stick { position: absolute; top: 25px; left: 25px; width: 50px; height: 50px; background: white; border-radius: 50%; }
        #attack-btn { position: fixed; bottom: 40px; right: 40px; width: 80px; height: 80px; background: rgba(255,0,0,0.6); border-radius: 50%; border: 4px solid white; display: flex; align-items: center; justify-content: center; font-size: 30px; color: white; }
    </style>
</head>
<body>

<div id="char-select">
    <h1>–í–´–ë–ï–†–ò –ì–ï–†–û–Ø</h1>
    <div class="char-grid">
        <div class="char-card red" onclick="startGame('RedShadow', 0xff0000)">RedShadow</div>
        <div class="char-card brown" onclick="startGame('MrFlicer', 0x5d4037)">MrFlicer</div>
        <div class="char-card blue" onclick="startGame('Joper546', 0x0000ff)">Joper546</div>
        <div class="char-card yellow" onclick="startGame('Dobrikotikleast', 0xffff00)">Dobrikotikleast</div>
    </div>
</div>

<div id="gui">
    <div class="card">
        <b id="p-name">–ò–≥—Ä–æ–∫</b>
        <div class="bar"><div id="hp-fill"></div></div>
        <div>üíé –ö—Ä–∏—Å—Ç–∞–ª–ª—ã: <span id="coins-txt">0</span></div>
    </div>
</div>

<div id="controls">
    <div id="joystick-zone"><div id="stick"></div></div>
    <div id="attack-btn">‚öîÔ∏è</div>
</div>

<script src="https://cdn.jsdelivr.net/npm/three@0.152.2/build/three.min.js"></script>

<script>
let playerHP = 100, coins = 0, gameStarted = false;
let joyX = 0, joyY = 0, yaw = 0, lastTouchX = 0;
const enemies = [];

// 1. –ò–ù–ò–¶–ò–ê–õ–ò–ó–ê–¶–ò–Ø THREE.JS (—Å—Ä–∞–∑—É —Å–æ–∑–¥–∞–µ–º —Å—Ü–µ–Ω—É, –Ω–æ –Ω–µ –∑–∞–ø—É—Å–∫–∞–µ–º —Ü–∏–∫–ª)
const scene = new THREE.Scene();
scene.background = new THREE.Color(0x87CEEB);
const camera = new THREE.PerspectiveCamera(75, window.innerWidth/window.innerHeight, 0.1, 1000);
const renderer = new THREE.WebGLRenderer({ antialias: true });
renderer.setSize(window.innerWidth, window.innerHeight);
document.body.appendChild(renderer.domElement);

const ambient = new THREE.AmbientLight(0xffffff, 0.8);
scene.add(ambient);
const ground = new THREE.Mesh(new THREE.PlaneGeometry(200, 200), new THREE.MeshStandardMaterial({color: 0x3ea33e}));
ground.rotation.x = -Math.PI/2;
scene.add(ground);

const player = new THREE.Group();
const pMesh = new THREE.Mesh(new THREE.BoxGeometry(0.7, 1.2, 0.5), new THREE.MeshStandardMaterial());
pMesh.position.y = 0.6;
player.add(pMesh);
scene.add(player);

// 2. –§–£–ù–ö–¶–ò–Ø –ó–ê–ü–£–°–ö–ê –ò–ì–†–´
function startGame(name, color) {
    document.getElementById('char-select').style.display = 'none';
    document.getElementById('gui').style.display = 'block';
    document.getElementById('controls').style.display = 'block';
    
    document.getElementById('p-name').innerText = name;
    pMesh.material.color.setHex(color);
    
    for(let i=0; i<5; i++) spawnEnemy();
    gameStarted = true;
    animate(); // –ó–∞–ø—É—Å–∫–∞–µ–º —Ü–∏–∫–ª —Ç–æ–ª—å–∫–æ –ø–æ—Å–ª–µ –≤—ã–±–æ—Ä–∞
}

function spawnEnemy() {
    const e = new THREE.Mesh(new THREE.BoxGeometry(0.8, 1.2, 0.8), new THREE.MeshStandardMaterial({color: 0x333333}));
    e.position.set(Math.random()*40-20, 0.6, Math.random()*40-20);
    e.userData = { hp: 30 };
    enemies.push(e);
    scene.add(e);
}

// 3. –£–ü–†–ê–í–õ–ï–ù–ò–ï
const stick = document.getElementById('stick');
window.addEventListener('touchstart', (e) => {
    for(let t of e.touches) if(t.clientX > window.innerWidth/2) lastTouchX = t.clientX;
});

window.addEventListener('touchmove', (e) => {
    if(!gameStarted) return;
    for(let t of e.touches) {
        if(t.clientX < window.innerWidth/2) {
            const rect = document.getElementById('joystick-zone').getBoundingClientRect();
            const dx = t.clientX - (rect.left + 50), dy = t.clientY - (rect.top + 50);
            const d = Math.min(Math.hypot(dx, dy), 40);
            const a = Math.atan2(dy, dx);
            joyX = Math.cos(a)*(d/40); joyY = Math.sin(a)*(d/40);
            stick.style.transform = `translate(${Math.cos(a)*d}px, ${Math.sin(a)*d}px)`;
        } else {
            yaw -= (t.clientX - lastTouchX) * 0.007;
            lastTouchX = t.clientX;
        }
    }
}, {passive: false});

window.addEventListener('touchend', () => { joyX = 0; joyY = 0; stick.style.transform = 'translate(0,0)'; });

document.getElementById('attack-btn').addEventListener('touchstart', () => {
    enemies.forEach((en, i) => {
        if(player.position.distanceTo(en.position) < 4) {
            en.userData.hp -= 15;
            if(en.userData.hp <= 0) {
                scene.remove(en); enemies.splice(i,1);
                coins += 5; document.getElementById('coins-txt').innerText = coins;
                setTimeout(spawnEnemy, 2000);
            }
        }
    });
});

// 4. –ì–õ–ê–í–ù–´–ô –¶–ò–ö–õ
const clock = new THREE.Clock();
function animate() {
    if(!gameStarted) return;
    requestAnimationFrame(animate);
    const dt = clock.get
