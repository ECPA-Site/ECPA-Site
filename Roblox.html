<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <title>Roblox Mobile - Character Select</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <style>
        body { margin: 0; overflow: hidden; background: #87CEEB; font-family: 'Segoe UI', sans-serif; touch-action: none; }
        #gui { position: fixed; top: 10px; left: 10px; color: white; pointer-events: none; z-index: 10; display: none; }
        .card { background: rgba(0,0,0,0.6); padding: 12px; border-radius: 12px; backdrop-filter: blur(8px); }
        .bar { width: 160px; height: 10px; background: #222; border-radius: 5px; margin-top: 5px; overflow: hidden; }
        #hp-fill { width: 100%; height: 100%; background: #00ff44; transition: width 0.3s; }
        
        /* –≠–∫—Ä–∞–Ω –≤—ã–±–æ—Ä–∞ –ø–µ—Ä—Å–æ–Ω–∞–∂–∞ */
        #char-select { position: fixed; inset: 0; background: radial-gradient(circle, #2c3e50, #000); display: flex; flex-direction: column; align-items: center; justify-content: center; z-index: 200; color: white; }
        .char-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 15px; margin-top: 20px; }
        .char-card { padding: 20px; border-radius: 15px; border: 3px solid rgba(255,255,255,0.2); text-align: center; cursor: pointer; transition: 0.3s; width: 140px; }
        .char-card:active { transform: scale(0.9); }
        
        /* –°—Ç–∏–ª–∏ –¥–ª—è –∫–∞—Ä—Ç–æ—á–µ–∫ */
        .red { background: #8b0000; } .brown { background: #5d4037; }
        .blue { background: #0d47a1; } .yellow { background: #fbc02d; color: black; }

        /* –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è */
        #menu-open { position: fixed; top: 10px; right: 10px; padding: 10px; background: rgba(0,0,0,0.6); color: white; border-radius: 8px; z-index: 15; display: none; border: 1px solid white; }
        #save-menu { position: fixed; inset: 0; background: rgba(0,0,0,0.9); display: none; flex-direction: column; align-items: center; justify-content: center; z-index: 300; color: white; }
        .slot { background: #222; margin: 5px; padding: 10px; border-radius: 8px; width: 250px; }

        /* –î–∂–æ–π—Å—Ç–∏–∫ –∏ –ê—Ç–∞–∫–∞ */
        #ui-controls { display: none; }
        #joystick-zone { position: fixed; bottom: 40px; left: 40px; width: 100px; height: 100px; background: rgba(255,255,255,0.1); border-radius: 50%; border: 2px solid white; }
        #stick { position: absolute; top: 25px; left: 25px; width: 50px; height: 50px; background: white; border-radius: 50%; opacity: 0.8; }
        #attack-btn { position: fixed; bottom: 40px; right: 40px; width: 80px; height: 80px; background: rgba(255,0,0,0.6); border-radius: 50%; border: 4px solid white; color: white; font-size: 30px; display: flex; align-items: center; justify-content: center; }
    </style>
</head>
<body>

<div id="char-select">
    <h1 style="text-shadow: 0 0 10px #fff;">–í–´–ë–ï–†–ò –ì–ï–†–û–Ø</h1>
    <div class="char-grid">
        <div class="char-card red" onclick="selectHero('RedShadow', 0xff0000)"><b>RedShadow</b></div>
        <div class="char-card brown" onclick="selectHero('MrFlicer', 0x5d4037)"><b>MrFlicer</b></div>
        <div class="char-card blue" onclick="selectHero('Joper546', 0x0000ff)"><b>Joper546</b></div>
        <div class="char-card yellow" onclick="selectHero('Dobrikotikleast', 0xffff00)"><b>Dobrikotikleast</b></div>
    </div>
</div>

<div id="gui">
    <div class="card">
        <b id="player-name">–ò–ì–†–û–ö</b>
        <div class="bar"><div id="hp-fill"></div></div>
        <div style="margin-top:5px;">üíé –ö–†–ò–°–¢–ê–õ–õ–´: <span id="coins">0</span></div>
    </div>
</div>

<div id="menu-open" onclick="toggleSaveMenu(true)">üíæ –°–õ–û–¢–´</div>

<div id="ui-controls">
    <div id="joystick-zone"><div id="stick"></div></div>
    <div id="attack-btn">‚öîÔ∏è</div>
</div>

<div id="save-menu">
    <h3>–°–û–•–†–ê–ù–ï–ù–ò–Ø</h3>
    <div id="slots-container"></div>
    <button onclick="toggleSaveMenu(false)" style="margin-top:20px; padding:10px 30px;">–ó–ê–ö–†–´–¢–¨</button>
</div>

<script src="https://cdn.jsdelivr.net/npm/three@0.152.2/build/three.min.js"></script>

<script>
/** --- –ü–ï–†–ï–ú–ï–ù–ù–´–ï --- **/
let playerHP = 100, coins = 0, currentHero = "", heroColor = 0xffffff;
let joyX = 0, joyY = 0, yaw = 0, lastTouchX = 0, lastHitTime = 0;
const enemies = [];

/** --- –í–´–ë–û–† –ì–ï–†–û–Ø --- **/
function selectHero(name, color) {
    currentHero = name;
    heroColor = color;
    document.getElementById('player-name').innerText = name;
    document.getElementById('char-select').style.display = 'none';
    document.getElementById('gui').style.display = 'block';
    document.getElementById('ui-controls').style.display = 'block';
    document.getElementById('menu-open').style.display = 'block';
    
    // –ü–µ—Ä–µ–∫—Ä–∞—à–∏–≤–∞–µ–º –∏–≥—Ä–æ–∫–∞
    playerModel.material.color.setHex(color);
    initGame();
}

/** --- –°–ò–°–¢–ï–ú–ê –°–û–•–†–ê–ù–ï–ù–ò–ô --- **/
function toggleSaveMenu(s) {
    document.getElementById('save-menu').style.display = s ? 'flex' : 'none';
    if(s) updateSlots();
}
function save(id) {
    const d = { hp: playerHP, coins, hero: currentHero, color: heroColor, date: new Date().toLocaleTimeString() };
    localStorage.setItem('slot_'+id, JSON.stringify(d));
    updateSlots();
}
function load(id) {
    const d = JSON.parse(localStorage.getItem('slot_'+id));
    if(d) {
        playerHP = d.hp; coins = d.coins;
        selectHero(d.hero, d.color);
        document.getElementById('coins').innerText = coins;
        toggleSaveMenu(false);
    }
}
function updateSlots() {
    const c = document.getElementById('slots-container');
    c.innerHTML = '';
    for(let i=1; i<=4; i++) {
        const d = JSON.parse(localStorage.getItem('slot_'+i));
        c.innerHTML += `<div class="slot">
            <b>–°–õ–û–¢ ${i}</b><br><small>${d ? d.hero+' | üíé'+d.coins+' | '+d.date : '–ü—É—Å—Ç–æ'}</small><br>
            <button onclick="save(${i})">Save</button> ${d ? `<button onclick="load(${i})">Load</button>` : ''}
        </div>`;
    }
}

/** --- –ì–†–ê–§–ò–ö–ê --- **/
const scene = new THREE.Scene();
scene.background = new THREE.Color(0x87CEEB);
const camera = new THREE.PerspectiveCamera(75, window.innerWidth/window.innerHeight, 0.1, 1000);
const renderer = new THREE.WebGLRenderer({ antialias: false });
renderer.setSize(window.innerWidth, window.innerHeight);
document.body.appendChild(renderer.domElement);

scene.add(new THREE.AmbientLight(0xffffff, 0.7));
const ground = new THREE.Mesh(new THREE.PlaneGeometry(200, 200), new THREE.MeshStandardMaterial({color: 0x3ea33e}));
ground.rotation.x = -Math.PI/2;
scene.add(ground);

const player = new THREE.Group();
const playerModel = new THREE.Mesh(new THREE.BoxGeometry(0.7, 1.2, 0.5), new THREE.MeshStandardMaterial({color: 0xffffff}));
playerModel.position.y =
