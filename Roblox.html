<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <title>Roblox Mobile - Full Camera</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <style>
        body { margin: 0; overflow: hidden; background: #87CEEB; font-family: sans-serif; touch-action: none; }
        #gui { position: fixed; top: 10px; left: 10px; color: white; pointer-events: none; z-index: 10; }
        .card { background: rgba(0,0,0,0.5); padding: 10px; border-radius: 10px; backdrop-filter: blur(5px); }
        .bar { width: 150px; height: 8px; background: #222; border-radius: 4px; margin-top: 5px; overflow: hidden; }
        #hp-fill { width: 100%; height: 100%; background: #00ff44; transition: 0.3s; }
        
        /* –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ */
        #joystick-zone { position: fixed; bottom: 40px; left: 40px; width: 100px; height: 100px; background: rgba(255,255,255,0.1); border-radius: 50%; border: 2px solid white; z-index: 20; }
        #stick { position: absolute; top: 25px; left: 25px; width: 50px; height: 50px; background: white; border-radius: 50%; opacity: 0.8; pointer-events: none; }
        
        #attack-btn { position: fixed; bottom: 40px; right: 40px; width: 70px; height: 70px; background: rgba(255,0,0,0.6); border-radius: 50%; border: 3px solid white; color: white; font-size: 30px; display: flex; align-items: center; justify-content: center; z-index: 20; }
    </style>
</head>
<body>

<div id="gui">
    <div class="card">
        <b>‚ù§Ô∏è HP</b>
        <div class="bar"><div id="hp-fill"></div></div>
        <div style="margin-top:5px;">üíé CRYSTALS: <span id="coins">0</span></div>
    </div>
</div>

<div id="joystick-zone"><div id="stick"></div></div>
<div id="attack-btn">‚öîÔ∏è</div>

<script src="https://cdn.jsdelivr.net/npm/three@0.152.2/build/three.min.js"></script>

<script>
/** --- –ù–ê–°–¢–†–û–ô–ö–ò --- **/
let playerHP = 100, coins = 0, isDead = false;
let joyX = 0, joyY = 0;
let yaw = 0, pitch = 0.5;
let lastTouchX = 0;
const enemies = [];

/** --- –°–¶–ï–ù–ê --- **/
const scene = new THREE.Scene();
scene.background = new THREE.Color(0x87CEEB);
scene.fog = new THREE.Fog(0x87CEEB, 20, 100);

const camera = new THREE.PerspectiveCamera(75, window.innerWidth/window.innerHeight, 0.1, 1000);
const renderer = new THREE.WebGLRenderer({ antialias: false });
renderer.setSize(window.innerWidth, window.innerHeight);
renderer.setPixelRatio(window.devicePixelRatio > 1 ? 1.5 : 1);
document.body.appendChild(renderer.domElement);

const ambient = new THREE.AmbientLight(0xffffff, 0.7);
scene.add(ambient);
const sun = new THREE.DirectionalLight(0xffffff, 0.8);
sun.position.set(10, 20, 10);
scene.add(sun);

// –¢—Ä–∞–≤–∞
const ground = new THREE.Mesh(
    new THREE.PlaneGeometry(200, 200),
    new THREE.MeshStandardMaterial({ color: 0x3ea33e })
);
ground.rotation.x = -Math.PI / 2;
scene.add(ground);

/** --- –ú–û–î–ï–õ–¨ –ò–ì–†–û–ö–ê --- **/
const player = new THREE.Group();
const body = new THREE.Mesh(new THREE.BoxGeometry(0.7, 1.2, 0.5), new THREE.MeshStandardMaterial({color: 0x00d4ff}));
body.position.y = 0.6;
player.add(body);
scene.add(player);

function spawnEnemy() {
    const e = new THREE.Mesh(new THREE.BoxGeometry(0.8, 1.2, 0.8), new THREE.MeshStandardMaterial({color: 0xff4400}));
    e.position.set(Math.random()*40-20, 0.6, Math.random()*40-20);
    e.userData = { hp: 30 };
    enemies.push(e);
    scene.add(e);
}
for(let i=0; i<5; i++) spawnEnemy();

/** --- –£–ü–†–ê–í–õ–ï–ù–ò–ï –ö–ê–ú–ï–†–û–ô –ò –î–ñ–û–ô–°–¢–ò–ö–û–ú --- **/
const stick = document.getElementById('stick');
const joyZone = document.getElementById('joystick-zone');

window.addEventListener('touchstart', (e) => {
    for(let i=0; i<e.touches.length; i++) {
        if(e.touches[i].clientX > window.innerWidth / 2) {
            lastTouchX = e.touches[i].clientX; // –ó–∞–ø–æ–º–∏–Ω–∞–µ–º –Ω–∞—á–∞–ª–æ –∫–∞—Å–∞–Ω–∏—è –¥–ª—è –∫–∞–º–µ—Ä—ã
        }
    }
}, {passive: false});

window.addEventListener('touchmove', (e) => {
    e.preventDefault();
    for(let i=0; i<e.touches.length; i++) {
        const t = e.touches[i];
        
        // –õ–ï–í–ê–Ø –ß–ê–°–¢–¨ - –î–ñ–û–ô–°–¢–ò–ö
        if (t.clientX < window.innerWidth / 2) {
            const rect = joyZone.getBoundingClientRect();
            const dx = t.clientX - (rect.left + 50);
            const dy = t.clientY - (rect.top + 50);
            const dist = Math.min(Math.hypot(dx, dy), 40);
            const angle = Math.atan2(dy, dx);
            joyX = Math.cos(angle) * (dist / 40);
            joyY = Math.sin(angle) * (dist / 40);
            stick.style.transform = `translate(${Math.cos(angle)*dist}px, ${Math.sin(angle)*dist}px)`;
        } 
        // –ü–†–ê–í–ê–Ø –ß–ê–°–¢–¨ - –í–†–ê–©–ï–ù–ò–ï –ö–ê–ú–ï–†–´
        else {
            const deltaX = t.clientX - lastTouchX;
            yaw -= deltaX * 0.007; // –ß—É–≤—Å—Ç–≤–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å –ø–æ–≤–æ—Ä–æ—Ç–∞
            lastTouchX = t.clientX;
        }
    }
}, {passive: false});

window.addEventListener('touchend', (e) => {
    if(e.touches.length === 0) {
        joyX = 0; joyY = 0;
        stick.style.transform = `translate(0,0)`;
    }
});

// –ê—Ç–∞–∫–∞
document.getElementById('attack-btn').addEventListener('touchstart', () => {
    enemies.forEach((e, i) => {
        if(player.position.distanceTo(e.position) < 4) {
            e.userData.hp -= 15;
            if(e.userData.hp <= 0) {
                scene.remove(e);
                enemies.splice(i, 1);
                coins += 5;
                document.getElementById('coins').innerText = coins;
                setTimeout(spawnEnemy, 2000);
            }
        }
    });
});

/** --- –ì–õ–ê–í–ù–´–ô –¶–ò–ö–õ --- **/
const clock = new THREE.Clock();
function animate() {
    requestAnimationFrame(animate);
    const dt = clock.getDelta();

    // –ü–µ—Ä–µ–¥–≤–∏–∂–µ–Ω–∏–µ
    if(Math.abs(joyX) > 0.1 || Math.abs(joyY) > 0.1) {
        const move = new THREE.Vector3(joyX, 0, joyY);
        move.applyAxisAngle(new THREE.Vector3(0,1,0), yaw);
        player.position.addScaledVector(move, 8 * dt);
        player.rotation.y = yaw + Math.atan2(-joyX, -joyY);
    }

    // –í—Ä–∞–≥–∏
    enemies.forEach(e => {
        const d = player.position.distanceTo(e.position);
        if(d < 15) {
            e.lookAt(player.position.x, 0.6, player.position.z);
            e.position.addScaledVector(new THREE.Vector3().subVectors(player.position, e.position).normalize(), 3 * dt);
            if(d < 1.4) {
                playerHP -= 10 * dt;
                document.getElementById('hp-fill').style.width = Math.max(0, playerHP) + "%";
                if(playerHP <= 0) location.reload();
            }
        }
    });

    // –ö–∞–º–µ—Ä–∞ (–û—Ä–±–∏—Ç–∞–ª—å–Ω–∞—è)
    const camDist = 10;
    camera.position.set(
        player.position.x + Math.sin(yaw) * camDist,
        player.position.y + 6,
        player.position.z + Math.cos(yaw) * camDist
    );
    camera.lookAt(player.position.x, player.position.y, player.position.z);

    renderer.render(scene, camera);
}
animate();

window.onresize = () => {
    camera.aspect = window.innerWidth/window.innerHeight;
    camera.updateProjectionMatrix();
    renderer.setSize(window.innerWidth, window.innerHeight);
};
</script>
</body>
</html>
