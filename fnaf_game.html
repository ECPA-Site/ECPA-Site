<!DOCTYPE html>
<html lang="ru">
<head>
<meta charset="UTF-8" />
<title>FNaF Game</title>
<style>
html, body {
    margin: 0; padding: 0;
    overflow: hidden;
    background: black;
    font-family: sans-serif;
}
#office3d {
    position: absolute; top: 0; left: 0;
    width: 100vw; height: 100vh; z-index: 1;
}
#monitorCanvas {
    position: absolute; top: 0; left: 0;
    width: 100vw; height: 100vh;
    z-index: 1000;
    display: none;
    background: black;
}
#monitorToggle {
    position: absolute; bottom: 0; left: 50%;
    transform: translateX(-50%);
    width: 200px; height: 40px;
    background: rgba(0,0,0,0.7);
    color: white;
    text-align: center; line-height: 40px;
    font-size: 20px; cursor: pointer;
    z-index: 9999; border-top: 2px solid white;
    user-select: none;
}
</style>
</head>
<body>

<canvas id="office3d"></canvas>
<canvas id="monitorCanvas"></canvas>
<div id="monitorToggle">Monitor</div>

<script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r152/three.min.js"></script>
<script>
/* GLOBAL */
let isMonitorOpen = false;
document.getElementById("monitorToggle").onclick = () => {
    isMonitorOpen = !isMonitorOpen;
    document.getElementById("monitorCanvas").style.display = isMonitorOpen ? "block" : "none";
};

/* ==============================
   THREE.JS OFFICE
============================== */
const officeCanvas = document.getElementById("office3d");
const renderer = new THREE.WebGLRenderer({ canvas: officeCanvas, antialias: true });
renderer.setSize(window.innerWidth, window.innerHeight);
const scene = new THREE.Scene();
const camera = new THREE.PerspectiveCamera(55, window.innerWidth/window.innerHeight, 0.1, 100);
camera.position.set(0, 1.4, 3);
scene.add(new THREE.AmbientLight(0x224422, 0.8));
const deskLight = new THREE.PointLight(0xffddaa,1,10); deskLight.position.set(0,1.5,1);
scene.add(deskLight);

/* FLOOR AND WALLS */
const floor = new THREE.Mesh(new THREE.PlaneGeometry(10,10), new THREE.MeshPhongMaterial({color:0x222222}));
floor.rotation.x=-Math.PI/2; scene.add(floor);
function makeWall(x,y,z,rotY=0){const w=new THREE.Mesh(new THREE.PlaneGeometry(10,5), new THREE.MeshPhongMaterial({color:0x333333}));
w.position.set(x,y,z); w.rotation.y=rotY; scene.add(w);}
makeWall(0,2.5,-5); makeWall(-5,2.5,0,Math.PI/2); makeWall(5,2.5,0,-Math.PI/2);

/* DESK */
const desk = new THREE.Mesh(new THREE.BoxGeometry(2.5,1,1), new THREE.MeshPhongMaterial({color:0x444444}));
desk.position.set(0,0.5,0.5); scene.add(desk);

/* FAN */
const fanGroup = new THREE.Group();
const fanBase = new THREE.Mesh(new THREE.CylinderGeometry(0.2,0.2,0.3,12), new THREE.MeshPhongMaterial({color:0x555555}));
fanBase.position.y=0.15; fanGroup.add(fanBase);
const bladeGeom=new THREE.BoxGeometry(1.2,0.05,0.2); const bladeMat=new THREE.MeshPhongMaterial({color:0x999999});
const blade1=new THREE.Mesh(bladeGeom, bladeMat); const blade2=new THREE.Mesh(bladeGeom, bladeMat); blade2.rotation.y=Math.PI/2;
fanGroup.add(blade1); fanGroup.add(blade2); fanGroup.position.set(0,1.1,0.1); scene.add(fanGroup);

/* CAMERA PARALLAX */
let targetCameraYaw=0, currentCameraYaw=0, maxYaw=0.6;
document.addEventListener("mousemove",(e)=>{const x=e.clientX/window.innerWidth; targetCameraYaw=(x-0.5)*2*maxYaw;});

/* DOORS AND LIGHTS */
const leftDoor=new THREE.Mesh(new THREE.BoxGeometry(1.2,3,0.1), new THREE.MeshPhongMaterial({color:0x222222})); leftDoor.position.set(-2.8,1.5,1); scene.add(leftDoor);
const rightDoor=new THREE.Mesh(new THREE.BoxGeometry(1.2,3,0.1), new THREE.MeshPhongMaterial({color:0x222222})); rightDoor.position.set(2.8,1.5,1); scene.add(rightDoor);
let leftDoorClosed=false, rightDoorClosed=false;
function animateDoor(door,closed){const targetY=closed?0.3:3; let speed=0.15;
function step(){if(Math.abs(door.position.y-targetY)>0.05){door.position.y+=(targetY-door.position.y)*speed; requestAnimationFrame(step);}else{door.position.y=targetY;}} step();}

const leftLight=new THREE.PointLight(0xffffff,0,6); leftLight.position.set(-4,1.5,1); scene.add(leftLight);
const rightLight=new THREE.

Daniil Makarov, [11.12.2025 23:03]
PointLight(0xffffff,0,6); rightLight.position.set(4,1.5,1); scene.add(rightLight);
let leftLightOn=false, rightLightOn=false;

/* BUTTONS */
function createButton(x,y,z){const btn=new THREE.Mesh(new THREE.BoxGeometry(0.3,0.3,0.1), new THREE.MeshPhongMaterial({color:0x555555})); btn.position.set(x,y,z); scene.add(btn); return btn;}
const leftDoorBtn=createButton(-2,1.3,0.4); const leftLightBtn=createButton(-2,1,0.4);
const rightDoorBtn=createButton(2,1.3,0.4); const rightLightBtn=createButton(2,1,0.4);

const raycaster=new THREE.Raycaster(); const mouse=new THREE.Vector2();
window.addEventListener("click",(e)=>{if(isMonitorOpen)return;
mouse.x=(e.clientX/window.innerWidth)*2-1; mouse.y=-(e.clientY/window.innerHeight)*2+1;
raycaster.setFromCamera(mouse,camera);
const objs=[leftDoorBtn,leftLightBtn,rightDoorBtn,rightLightBtn]; const hits=raycaster.intersectObjects(objs);
if(hits.length>0){const obj=hits[0].object;
if(obj===leftDoorBtn){leftDoorClosed=!leftDoorClosed; animateDoor(leftDoor,leftDoorClosed);}
if(obj===leftLightBtn){leftLightOn=!leftLightOn; leftLight.intensity=leftLightOn?2:0;}
if(obj===rightDoorBtn){rightDoorClosed=!rightDoorClosed; animateDoor(rightDoor,rightDoorClosed);}
if(obj===rightLightBtn){rightLightOn=!rightLightOn; rightLight.intensity=rightLightOn?2:0;}
}});

/* ==============================
   MONITOR + ANIMATRONICS
============================== */
const monitorCanvas=document.getElementById("monitorCanvas"); const monitorCtx=monitorCanvas.getContext("2d");
monitorCanvas.width=window.innerWidth; monitorCanvas.height=window.innerHeight;
window.addEventListener("resize",()=>{monitorCanvas.width=window.innerWidth; monitorCanvas.height=window.innerHeight;});

function drawRoomBackground(ctx){ctx.fillStyle="#111"; ctx.fillRect(0,0,monitorCanvas.width,monitorCanvas.height);
ctx.strokeStyle="#444"; ctx.lineWidth=2; ctx.strokeRect(50,50,monitorCanvas.width-100,monitorCanvas.height-100);
ctx.beginPath(); ctx.moveTo(50,monitorCanvas.height/2); ctx.lineTo(monitorCanvas.width-50,monitorCanvas.height/2); ctx.stroke();}

const animatronics=[
{name:"Bonnie",x:0.3,y:0.5,visible:true},
{name:"Chica",x:0.7,y:0.5,visible:true},
{name:"Freddy",x:0.5,y:0.3,visible:false}];

function drawSilhouette(ctx,a){if(!a.visible)return;
const w=monitorCanvas.width, h=monitorCanvas.height, px=a.x*w, py=a.y*h;
ctx.fillStyle="#000"; ctx.beginPath(); ctx.ellipse(px,py,50,60,0,0,2*Math.PI);
ctx.moveTo(px-35,py-60); ctx.lineTo(px-20,py-10); ctx.lineTo(px-25,py-60);
ctx.moveTo(px+35,py-60); ctx.lineTo(px+20,py-10); ctx.lineTo(px+25,py-60); ctx.fill();
ctx.fillStyle="white"; ctx.beginPath(); ctx.arc(px-15,py-10,5,0,2*Math.PI); ctx.arc(px+15,py-10,5,0,2*Math.PI); ctx.fill();}

function applyStatic(ctx){const w=monitorCanvas.width,h=monitorCanvas.height; const imageData=ctx.getImageData(0,0,w,h); const data=imageData.data;
for(let i=0;i<data.length;i+=4){const v=Math.random()*20-10; data[i]+=v; data[i+1]+=v; data[i+2]+=v;}
ctx.putImageData(imageData,0,0); ctx.strokeStyle="rgba(255,255,255,0.03)";
for(let y=0;y<h;y+=3){ctx.beginPath(); ctx.moveTo(0,y); ctx.lineTo(w,y); ctx.stroke();}}

function renderMonitor(){if(!isMonitorOpen)return; drawRoomBackground(monitorCtx); animatronics.forEach(drawSilhouette); applyStatic(monitorCtx); requestAnimationFrame(renderMonitor);}
renderMonitor();

/* AI ANIMATRONICS */
function aiMoveAnimatronics(){animatronics.forEach(a=>{if(a.name==="Bonnie"||a.name==="Chica"){a.visible=Math.random()>0.5;}});
const doorsClosed=leftDoorClosed&&rightDoorClosed; animatronics.find(a=>a.name==="Freddy").visible=doorsClosed?true:false;
setTimeout(aiMoveAnimatronics,3000+Math.random()*3000);} aiMoveAnimatronics();

/* ==============================
   SOUND + POWER + TIME
============================== */
const audioCtx = new (window.AudioContext||window.webkitAudioContext)();
const SoundManager={
fan:null,
door:()=>{const osc=audioCtx.createOscillator(); const gain=audioCtx.createGain(); osc.type="triangle"; osc.frequency.setValueAtTime(100,audioCtx.currentTime); gain.gain.setValueAtTime(0.3,audioCtx.currentTime); osc.

Daniil Makarov, [11.12.2025 23:03]
connect(gain).connect(audioCtx.destination); osc.start(); osc.stop(audioCtx.currentTime+0.2);},
camera:()=>{const osc=audioCtx.createOscillator(); osc.type="sine"; osc.frequency.setValueAtTime(1000,audioCtx.currentTime); const gain=audioCtx.createGain(); gain.gain.setValueAtTime(0.2,audioCtx.currentTime); osc.connect(gain).connect(audioCtx.destination); osc.start(); osc.stop(audioCtx.currentTime+0.1);},
jumpscare:()=>{const bufferSize=2*audioCtx.sampleRate; const buffer=audioCtx.createBuffer(1,bufferSize,audioCtx.sampleRate); const data=buffer.getChannelData(0);
for(let i=0;i<bufferSize;i++)data[i]=(Math.random()*2-1)*0.5;
const source=audioCtx.createBufferSource(); source.buffer=buffer; source.connect(audioCtx.destination); source.start();},
};

/* POWER */
let power=100;
const powerDrainRate=0.01, powerDrainDoor=0.03, powerDrainLight=0.05;
function drainPower(){let drain=powerDrainRate;
if(leftDoorClosed) drain+=powerDrainDoor;
if(rightDoorClosed) drain+=powerDrainDoor;
if(leftLightOn) drain+=powerDrainLight;
if(rightLightOn) drain+=powerDrainLight;
power-=drain; if(power<0) power=0; requestAnimationFrame(drainPower);}
drainPower();

/* NIGHT TIMER */
let timeMinutes=0; const nightDuration=360;
function advanceTime(){timeMinutes+=1;
if(timeMinutes>=nightDuration){alert("YOU SURVIVED! 6AM!"); location.reload();}
if(power<=0){SoundManager.jumpscare(); alert("POWER OUT! GAME OVER!"); location.reload();}
setTimeout(advanceTime,1000);}
advanceTime();

/* POWER UI */
const powerBar=document.createElement("div"); powerBar.style.position="absolute"; powerBar.style.top="10px"; powerBar.style.right="10px"; powerBar.style.width="200px"; powerBar.style.height="20px"; powerBar.style.border="2px solid white"; powerBar.style.background="#222"; powerBar.style.zIndex=9999; document.body.appendChild(powerBar);
const powerFill=document.createElement("div"); powerFill.style.width="100%"; powerFill.style.height="100%"; powerFill.style.background="lime"; powerBar.appendChild(powerFill);
function updatePowerUI(){powerFill.style.width=power+"%"; requestAnimationFrame(updatePowerUI);}
updatePowerUI();

/* MAIN LOOP */
function loop(){blade1.rotation.y+=0.2; blade2.rotation.y+=0.2; currentCameraYaw+=(targetCameraYaw-currentCameraYaw)*0.1; camera.rotation.y=currentCameraYaw;
renderer.render(scene,camera); requestAnimationFrame(loop);}
loop();

window.addEventListener("resize",()=>{renderer.setSize(window.innerWidth,window.innerHeight); camera.aspect=window.innerWidth/window.innerHeight; camera.updateProjectionMatrix();});
</script>

</body>
</html>
