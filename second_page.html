<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Personal Account</title>

<style>
:root { --bg:#0b0c0f; --card:#15171c; --accent:#8ab4ff; }

body{
    margin:0;
    min-height:100vh;
    display:grid;
    place-items:center;
    font-family:Inter,Segoe UI,Roboto,Arial,sans-serif;
    background:var(--bg);
    color:#e4e7eb;
    padding:20px;
    position: relative;
}

.card{
    height: 900px;
    width: 93%;
    max-width:1500px;
    background:var(--card);
    border-radius:16px;
    padding:32px;
    text-align:left;
    position: relative;
    z-index: 1;
}

h1{
    font-size:60px;
    color:#8ab4ff;
    text-transform:uppercase;
}

img{
    height:300px;
    width:300px;
    margin-bottom:16px;
    margin-left:9px;
    border-radius:16px;
    float:left;
}

.info{
    float:left;
    margin-left:25px;
    margin-top:20px;
    font-size:30px;
}

.info p{
    margin:10px 0;
    font-size:35px;
}

.btn{
    position:absolute;
    bottom:32px;
    right:32px;
    background:var(--accent);
    color:#0a0d12;
    font-weight:600;
    padding:12px 20px;
    border-radius:12px;
    border:0;
    cursor:pointer;
    text-transform:uppercase;
    text-decoration:none;
}

.btn:hover{ background:#6da4ff; }

.btn2{
    position:absolute;
    bottom:32px;
    right:150px;
    background:#c8ddff;
    color:#0a0d12;
    font-weight:600;
    padding:12px 20px;
    border-radius:12px;
    cursor:pointer;
    text-transform:uppercase;
    text-decoration:none;
}

.btn2:hover{ background:hsl(217,100%,82%); }
</style>
</head>

<body>
    
<h1>Welcome</h1>
    
<main class="card">
    <img src="Photos/ManInSquare.jpg" alt="Worker Photo">
    <div class="info" id="userinfo"><p>Loading...</p></div>

    <a id="adminBtn" class="btn2" href="#">Admin Panel</a>
    <a href="index.html" class="btn">Log Out</a>
</main>

<script>
const params = new URLSearchParams(window.location.search);
const code = params.get("user");

if (!code) {
    document.getElementById("userinfo").innerHTML = "Ошибка: код не найден";
}

// 1) Находим имя по коду
fetch("users.txt")
.then(r => r.text())
.then(text => {
    const lines = text.trim().split("\n");
    let username = null;

    for (let line of lines) {
        const parts = line.split(":"); // name : pass : code
        if (parts[2] === code) {
            username = parts[0];
            break;
        }
    }

    if (!username) {
        document.getElementById("userinfo").innerHTML = "Пользователь не найден";
        return;
    }

    // 2) Получаем инфо пользователя
    fetch("infoUser.txt")
    .then(r => r.text())
    .then(text2 => {
        const lines2 = text2.trim().split("\n");
        let userInfo = null;

        for (let line of lines2) {
            const parts = line.split("|"); // name | rank | money | photo
            if (parts[0] === username) {
                userInfo = parts;
                break;
            }
        }

        if (!userInfo) {
            document.getElementById("userinfo").innerHTML = "Информация о пользователе не найдена";
            return;
        }

        const [name, rank, money, photo] = userInfo;

        // Обновляем ссылку к админке
        const adminBtn = document.getElementById("adminBtn");
        adminBtn.href = "AdminRoom.html?user=" + encodeURIComponent(code);

        // Обновляем фото
        const imgElement = document.querySelector("img");
        imgElement.src = "Photos/" + photo;
        imgElement.alt = name + " Photo";

        // Вывод информации
        document.getElementById("userinfo").innerHTML = `
            <p><code>name:</code> <b>${name}</b></p>
            <p><code>rank:</code> <b>${rank}</b></p>
            <p><code>points:</code> <b>${money}</b> ඩ</p>
        `;
    });
});
</script>

</body>
</html>

